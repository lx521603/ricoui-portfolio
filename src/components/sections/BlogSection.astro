---
const { allPosts = [], listPage = false, postsPerPage = 6, pagination = { enable: false, currentPage: 1 }, showViewAllButton = false } = Astro.props;

// 按发布日期排序文章
const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf()
);

// 计算分页
const currentPage = pagination?.currentPage || 1;
const startIndex = (currentPage - 1) * postsPerPage;
const endIndex = startIndex + postsPerPage;
const paginatedPosts = sortedPosts.slice(startIndex, endIndex);
---
<section class="blog-section">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {paginatedPosts.map(post => (
      <article class="blog-card">
        <a href={`/blog/${post.slug}`}>
          <h2>{post.data.title}</h2>
          <p>{post.data.description}</p>
        </a>
      </article>
    ))}
  </div>

  {pagination?.enable && (
    <div class="pagination mt-8 flex justify-center gap-4">
      {currentPage > 1 && (
        <a href={`/blog/page/${currentPage - 1}`} class="prev">Previous</a>
      )}
      <span class="current">{currentPage}</span>
      {endIndex < sortedPosts.length && (
        <a href={`/blog/page/${currentPage + 1}`} class="next">Next</a>
      )}
    </div>
  )}
</section>