---
import { getCollection } from "astro:content";
import BlogCard from "@/components/cards/BlogCard.astro";

const { title, description, showViewAllButton = false, limit = 6 } = Astro.props;

// 获取全部博客文章
const allPosts = await getCollection("blog");

// 过滤 draft 并按 publishDate 倒序
const sortedPosts = allPosts
  .filter(p => !p.data?.draft)
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());

// 限制数量
const posts = limit ? sortedPosts.slice(0, limit) : sortedPosts;
---

<section class="blog-section container mx-auto py-10">
  {title && <h2 class="text-3xl font-bold mb-6">{title}</h2>}
  {description && <p class="text-neutral-600 dark:text-neutral-400 mb-8">{description}</p>}

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {posts.map(post => (
      <BlogCard content={{
        ...post.data,
        slug: post.id,
        link: `/blog/${post.id}`
      }} />
    ))}
  </div>

  {showViewAllButton && (
    <div class="mt-8 text-center">
      <a href="/blog" class="inline-block text-primary font-semibold hover:underline">
        查看全部文章 →
      </a>
    </div>
  )}
</section>