---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import works from "@/collections/featuredwork.json";

// 获取博客文章的标签
const allPosts = await getCollection("post");
const blogTagCounts = {};
allPosts.forEach(post => {
  if (post.data.tags && Array.isArray(post.data.tags)) {
    post.data.tags.forEach(tag => {
      blogTagCounts[tag] = (blogTagCounts[tag] || 0) + 1;
    });
  }
});

// 获取作品的标签
const workTagCounts = {};
works.forEach(work => {
  if (work.tags && Array.isArray(work.tags) && work.isShow !== false) {
    work.tags.forEach(tag => {
      workTagCounts[tag] = (workTagCounts[tag] || 0) + 1;
    });
  }
});

// 合并所有标签
const allTagCounts = {};
[...Object.keys(blogTagCounts), ...Object.keys(workTagCounts)].forEach(tag => {
  allTagCounts[tag] = (blogTagCounts[tag] || 0) + (workTagCounts[tag] || 0);
});

// 按文章数量排序
const tags = Object.entries(allTagCounts)
  .map(([tag, count]) => ({ tag, count: count as number }))
  .sort((a, b) => (b.count as number) - (a.count as number));
---

<Layout title="标签" description="按标签浏览文章和作品">
  <section class="site-container m-auto">
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold mb-4">标签</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        按标签浏览文章和作品
      </p>
    </div>
    
    <div class="flex flex-wrap gap-3 justify-center">
      {tags.length > 0 ? (
        tags.map(({ tag, count }) => (
          <a
            href={`/tags/${tag}/`}
            class="inline-flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors group"
          >
            <span class="font-medium text-gray-800 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400">
              {tag}
            </span>
            <span class="ml-2 px-1.5 py-0.5 text-xs bg-white dark:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400">
              {count}
            </span>
          </a>
        ))
      ) : (
        <div class="text-center text-gray-500 dark:text-gray-400 w-full">
          <p>未找到标签。</p>
        </div>
      )}
    </div>
  </section>
</Layout>