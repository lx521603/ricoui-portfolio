---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("post");
  
  // 收集所有 tags 并统计 - 修复类型问题
  const tagCounts: Record<string, number> = {};
  posts.forEach(post => {
    if (post.data.tags) {
      post.data.tags.forEach((tag: string) => {
        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
      });
    }
  });
  
  // 按文章数量排序 - 修复类型问题
  const sortedTags = Object.entries(tagCounts)
    .sort(([, a]: [string, number], [, b]: [string, number]) => (b as number) - (a as number))
    .map(([tag, count]) => ({ tag, count }));
  
  return {
    props: {
      tags: sortedTags
    }
  };
}

interface TagItem {
  tag: string;
  count: number;
}

const { tags } = Astro.props as { tags: TagItem[] };
---

<Layout title="Tags" description="Browse all tags">
  <section class="relative z-20 container mx-auto my-12 px-7 lg:px-0">
    <div class="text-center">
      <h1 class="text-4xl font-bold mb-4">Tags</h1>
      <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        Browse articles by tags
      </p>
    </div>
    
    <div class="mt-12 max-w-4xl mx-auto">
      <div class="flex flex-wrap gap-4 justify-center">
        {tags.map(({ tag, count }: TagItem) => (
          <a
            href={`/tags/${tag}/`}
            class="inline-flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors group"
          >
            <span class="font-medium text-gray-800 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400">
              {tag}
            </span>
            <span class="ml-2 px-1.5 py-0.5 text-xs bg-white dark:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400">
              {count}
            </span>
          </a>
        ))}
      </div>
    </div>
  </section>
</Layout>