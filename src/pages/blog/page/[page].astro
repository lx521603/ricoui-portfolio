---
import Layout from "@/layouts/Layout.astro";
import PageHeader from "@/components/elements/PageHeader.astro";
import BlogSection from "@/components/sections/BlogSection.astro";
import { getCollection } from "astro:content";

export const POSTS_PER_PAGE = 6;

export async function getStaticPaths() {
  const allPosts = (await getCollection("post"))
    .filter(p => !p.data?.draft && !p.data?.featured)
    .sort((a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf());

  const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);

  return Array.from({ length: totalPages }, (_, i) => {
    const page = i + 1;
    return {
      params: { page: page.toString() },
      props: { page: page.toString() }
    };
  });
}

const { page } = Astro.props;
const currentPage = parseInt(page);

let allPosts = await getCollection("post");
allPosts = allPosts.filter(p => !p.data?.draft && !p.data?.featured);
allPosts.sort((a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf());
---

<Layout title={`Blog - Page ${currentPage}`}>
  <section class="relative z-20 container mx-auto my-12 px-7 lg:px-0">
    <PageHeader
      title="Blog"
      description="Explore my thoughts on design and development, the convergence of thinking and innovation."
    />
  </section>

  <section class="relative z-20 mx-auto my-12 px-7 lg:px-0">
    <div class="mt-12">
      <BlogSection
        title="All Articles"
        allPosts={allPosts}
        listPage={true}
        pagination={{ enable: true, currentPage }}
        postsPerPage={POSTS_PER_PAGE}
      />
    </div>
  </section>
</Layout>