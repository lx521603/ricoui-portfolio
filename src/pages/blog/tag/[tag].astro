---
import Layout from "@/layouts/Layout.astro";
import PageHeader from "@/components/elements/PageHeader.astro";
import BlogSection from "@/components/sections/BlogSection.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("post");

const { tag } = Astro.params;
if (!tag) return Astro.redirect("/404");

const postsWithTag = allPosts.filter(p => p.data.tags?.includes(tag));

const POSTS_PER_PAGE = 6;
const currentPage = 1;
---

<Layout title={`Tag: ${tag}`}>
  <section class="relative z-20 container mx-auto my-12 px-7 lg:px-0">
    <PageHeader
      title={`Tag: ${tag}`}
      description={`查看所有包含标签 "${tag}" 的文章`}
    />
  </section>
  <section class="relative z-20 mx-auto my-12 lg:px-0">
    <div class="mt-12">
      <BlogSection
        title=""
        listPage={true}
        postsPerPage={POSTS_PER_PAGE}
        pagination={{ enable: true, currentPage }}
        allPosts={postsWithTag}
      />
    </div>
  </section>
</Layout>